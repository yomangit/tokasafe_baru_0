/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x43357f from'./../messagescompressor.js';import _0x81b20 from'./messages/addsuggestionmessage.js';import _0x16fec3 from'./responses/addsuggestionresponse.js';import _0x35116d from'./messages/getsuggestionmessage.js';import _0x534f8b from'./responses/getsuggestionresponse.js';import _0x358350 from'./messages/getallsuggestionsmessage.js';import _0x5b3df6 from'./responses/getallsuggestionsresponse.js';import _0x4bff53 from'./messages/updatesuggestionmessage.js';import _0x25a7e6 from'./messages/connectmessage.js';import _0x3c8b81 from'./responses/connectresponse.js';import _0x193d2b from'../ckeditorcloudserviceserror.js';import _0x3189b1,{WEB_SOCKET_GATEWAY_STATES}from'../websocketgateway/websocketgateway.js';import _0x5e0526 from'../errors/ServiceNotConnectedError.js';import _0x116514 from'../ckeditorcloudservicesservererror.js';import _0x2f1332 from'./messages/batchUpdateSuggestionsStateMessage.js';export const _SERVICE=0xa;class TrackChangesService extends/* #__PURE__ -- @preserve */
EmitterMixin(){constructor(_0xa71f4c){super(),this['_documentId']=_0xa71f4c,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x122f08){if(this['_isConnected'])return;if(_0x122f08['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x193d2b('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x122f08);const _0x3f355b=new _0x25a7e6(this['_documentId']);this['_wsGateway']=_0x122f08,this['stopListening'](_0x122f08,'change:state');const _0x19eff0=await _0x122f08['_sendRequest'](0xa,_0x25a7e6['TYPE'],_0x43357f['encode'](_0x3f355b)),_0x47559b=_0x43357f['decode'](_0x19eff0,_0x3c8b81);return this['listenTo'](_0x122f08,'change:state',(_0x2e788d,_0x33bf64,_0x490a23)=>this['_onWsGatewayStateChange'](_0x490a23),{'priority':_0x3189b1['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x122f08,_0x47559b['channel']),this['_isConnected']=!0x0,this['fire']('connected'),_0x47559b['suggestions'];}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['add'](_0x4c0e0c,_0x4d55b4,_0x479118,_0x56e872=null,_0x57ef4f){const _0x277d62=new _0x81b20(_0x4c0e0c,this['_documentId'],_0x4d55b4,_0x479118,_0x56e872,_0x57ef4f),_0x53dbe7=await this['_sendRequest'](_0x81b20['TYPE'],_0x277d62);return _0x43357f['decode'](_0x53dbe7,_0x16fec3);}async['get'](_0x17979f,_0x39597a=0x1){const _0x191653=new _0x35116d(_0x17979f,this['_documentId']);try{const _0x322cb8=await this['_sendRequest'](_0x35116d['TYPE'],_0x191653);return _0x43357f['decode'](_0x322cb8,_0x534f8b);}catch(_0x225a91){if('CKEditorCloudServicesServerError'===_0x225a91['name']&&'404'===_0x225a91['code']&&_0x39597a<0x5)return await(_0x2fb700=0x64*_0x39597a,new Promise(_0x11ff86=>{setTimeout(_0x11ff86,_0x2fb700);})),this['get'](_0x17979f,_0x39597a+0x1);if('CKEditorCloudServicesServerError'===_0x225a91['name'])throw _0x225a91;throw _0x116514['fromPublicError'](_0x225a91);}var _0x2fb700;}async['getAll'](){const _0x40eca0=new _0x358350(this['_documentId']),_0x3a1770=await this['_sendRequest'](_0x358350['TYPE'],_0x40eca0),{suggestions:_0x3bdf2b}=_0x43357f['decode'](_0x3a1770,_0x5b3df6);return _0x3bdf2b;}async['update'](_0x347964,_0x581486={}){const {hasComments:_0x15a38a,state:_0x1da625,attributes:_0x277c0b}=_0x581486,_0x25e785=void 0x0!==_0x15a38a,_0x2f3fb7=new _0x4bff53(_0x347964,this['_documentId'],_0x15a38a,_0x25e785,_0x1da625,_0x277c0b);await this['_sendRequest'](_0x4bff53['TYPE'],_0x2f3fb7);}async['batchUpdateState'](_0x41b5c0){const _0x186e26=new _0x2f1332(_0x41b5c0['ids'],this['_documentId'],_0x41b5c0['state']);await this['_sendRequest'](_0x2f1332['TYPE'],_0x186e26);}['_connectToChannel'](_0xfe9c21,_0x14c41c){this['_channel']=_0xfe9c21['_getChannel'](TrackChangesService['_SERVICE'],_0x14c41c),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x4bff53['TYPE']),(_0x50b9ce,_0x10ab20)=>{const _0x13da98=_0x43357f['decode'](_0x10ab20,_0x4bff53);this['fire']('suggestionUpdated',_0x13da98);});}['_onWsGatewayStateChange'](_0x17d887){_0x17d887===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x3e1cc7,_0x696260){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x5e0526('Track\x20Changes',this);return this['_wsGateway']['_sendRequest'](0xa,_0x3e1cc7,_0x43357f['encode'](_0x696260));}}TrackChangesService['_SERVICE']=0xa;export default TrackChangesService;