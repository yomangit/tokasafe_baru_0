/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x43a74d from'./../messagescompressor.js';import _0x52e178 from'./messages/revisionhistorygetrevisionmessage.js';import _0x2c669d from'./responses/revisionhistorygetrevisionresponse.js';import _0x3d339c from'./messages/revisionhistoryupdaterevisionsmessage.js';import _0x172d14 from'./responses/revisionhistoryupdaterevisionsresponse.js';import _0x1213fd from'./messages/revisionhistoryconnectmessage.js';import _0x5d8c26 from'./responses/revisionhistoryconnectresponse.js';import _0x315383 from'./messages/revisionhistoryreconnectmessage.js';import _0x42f2ca from'../ckeditorcloudserviceserror.js';import _0x25b6d6,{WEB_SOCKET_GATEWAY_STATES}from'../websocketgateway/websocketgateway.js';import _0x51e305 from'../errors/ServiceNotConnectedError.js';export const _SERVICE=0xc;class RevisionHistoryService extends/* #__PURE__ -- @preserve */
EmitterMixin(){constructor(_0x43d53c){super(),this['_documentId']=_0x43d53c,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}['connect'](_0x353074){return this['_isConnected']?Promise['resolve']():this['_connect'](_0x353074,new _0x1213fd(this['_documentId']));}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}['reconnect'](_0x3741fa,_0x135f47){if(this['isConnected'])throw new _0x42f2ca('Cannot\x20reconnect\x20to\x20already\x20connected\x20service.',_0x3741fa);return this['_connect'](_0x3741fa,new _0x315383(this['_documentId'],_0x135f47));}async['updateRevisions'](_0x247047,_0x1895a1){const _0x249fff=_0x3d339c['create']({'documentId':this['_documentId'],'requestId':_0x1895a1,'revisions':_0x247047}),_0x128e07=await this['_sendRequest'](_0x3d339c['TYPE'],_0x249fff),{requestId:_0x1e17c0}=_0x43a74d['decode'](_0x128e07,_0x172d14);return _0x1e17c0;}async['getRevision'](_0x508bb3){const _0x4ecd4f=new _0x52e178(this['_documentId'],_0x508bb3),_0x4447e2=await this['_sendRequest'](_0x52e178['TYPE'],_0x4ecd4f);return _0x43a74d['decode'](_0x4447e2,_0x2c669d)['toObject']();}async['_connect'](_0x1263db,_0x42a77d){if(_0x1263db['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x42f2ca('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x1263db);this['_wsGateway']=_0x1263db,this['stopListening'](_0x1263db,'change:state');const _0x375910=await _0x1263db['_sendRequest'](0xc,_0x42a77d['constructor']['TYPE'],_0x43a74d['encode'](_0x42a77d)),{channel:_0x49146c,requestId:_0x1ef7d3,revisions:_0x3e07d7}=_0x43a74d['decode'](_0x375910,_0x5d8c26)['toObject']();return this['listenTo'](_0x1263db,'change:state',(_0x58b498,_0x178b4e,_0x329389)=>this['_onWsGatewayStateChange'](_0x329389),{'priority':_0x25b6d6['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x1263db,_0x49146c),this['_isConnected']=!0x0,this['fire']('connected'),{'revisions':_0x3e07d7,'requestId':_0x1ef7d3};}['_connectToChannel'](_0x45ccc8,_0xffeed4){this['_channel']=_0x45ccc8['_getChannel'](RevisionHistoryService['_SERVICE'],_0xffeed4),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x3d339c['TYPE']),(_0x12fba3,_0x1799a9)=>{const {documentId:_0x13f017,requestId:_0x4e14c,revisions:_0x4ab2e8}=_0x43a74d['decode'](_0x1799a9,_0x3d339c)['toObject']();this['fire']('revisionsUpdated',{'documentId':_0x13f017,'requestId':_0x4e14c,'revisionsData':_0x4ab2e8});});}['_onWsGatewayStateChange'](_0x1da879){_0x1da879===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x5c0e35,_0x4f7e56){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x51e305('Revision\x20History',this);return this['_wsGateway']['_sendRequest'](0xc,_0x5c0e35,_0x43a74d['encode'](_0x4f7e56));}}RevisionHistoryService['_SERVICE']=0xc;export default RevisionHistoryService;