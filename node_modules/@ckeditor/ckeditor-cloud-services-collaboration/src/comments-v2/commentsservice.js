/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x4e19b2 from'./../messagescompressor.js';import _0x4cde4a from'./messages/addcommentmessage.js';import _0x22cc14 from'./responses/addcommentresponse.js';import _0x2f4c29 from'./messages/connectmessage.js';import _0x48c144 from'./responses/connectresponse.js';import _0x44abe2 from'./messages/removecommentmessage.js';import _0x44cb61 from'./messages/removecommentthreadmessage.js';import _0x31fa89 from'./messages/updatecommentmessage.js';import _0x183f9f from'./messages/getcommentthreadmessage.js';import _0x4a3b9d from'./responses/getcommentthreadresponse.js';import _0xfe35a7 from'./messages/getdocumentthreadsmessage.js';import _0x35b79f from'./responses/getdocumentthreadsresponse.js';import _0x4ea53a,{WEB_SOCKET_GATEWAY_STATES}from'./../websocketgateway/websocketgateway.js';import _0x22db82 from'./../ckeditorcloudserviceserror.js';import _0x210767 from'../sessions/sessions.js';import _0x169f97 from'../errors/ServiceNotConnectedError.js';import _0x2f3a17 from'../ckeditorcloudservicesservererror.js';import _0x2e10b1 from'./responses/comment-threads/addcommentthreadresponse.js';import _0x3606cf from'./messages/comment-threads/addcommentthreadmessage.js';import _0x23fd91 from'./messages/comment-threads/resolvecommentthreadmessage.js';import _0x1d096b from'./messages/comment-threads/reopencommentthreadmessage.js';import _0x441895 from'./messages/comment-threads/updatecommentthreadmessage.js';import _0x249faa from'./responses/comment-threads/resolvecommentthreadresponse.js';export const _SERVICE=0x9;class CommentsService extends/* #__PURE__ -- @preserve */
EmitterMixin(){constructor(_0x186918){super(),this['_documentId']=_0x186918,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x318935){if(this['_isConnected'])return;if(_0x318935['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x22db82('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x318935);const _0x2c75b5=new _0x2f4c29(this['_documentId']);this['_wsGateway']=_0x318935,this['stopListening'](_0x318935,'change:state');const _0x21e612=await _0x318935['_sendRequest'](0x9,_0x2f4c29['TYPE'],_0x4e19b2['encode'](_0x2c75b5)),{channel:_0x4ad29b,threads:_0x3cdea3}=_0x4e19b2['decode'](_0x21e612,_0x48c144);return this['listenTo'](_0x318935,'change:state',(_0xd533c5,_0x38e532,_0x48b910)=>this['_onWsGatewayStateChange'](_0x48b910),{'priority':_0x4ea53a['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x318935,_0x4ad29b),this['_isConnected']=!0x0,this['fire']('connected'),_0x3cdea3;}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['_connectedSessions']&&(this['_connectedSessions']['disconnect'](),this['_connectedSessions']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['addComment'](_0xd4bf04,_0x55d7bc,_0x23ab7c,_0x41f94b){const _0x476a08=new _0x4cde4a(this['_documentId'],_0xd4bf04,_0x23ab7c,_0x55d7bc,void 0x0,void 0x0,_0x41f94b),_0x2a8655=await this['_sendRequest'](_0x4cde4a['TYPE'],_0x476a08);return _0x4e19b2['decode'](_0x2a8655,_0x22cc14);}async['updateComment'](_0x513cd3,_0x109145,_0xbf7b07,_0x1ba69d){const _0x3417d9=void 0x0!==_0x1ba69d,_0xd83ed7=new _0x31fa89(this['_documentId'],_0x513cd3,_0x109145,_0xbf7b07,_0x1ba69d,_0x3417d9);await this['_sendRequest'](_0x31fa89['TYPE'],_0xd83ed7);}async['removeComment'](_0x28138d,_0x3e82b9){const _0x183629=new _0x44abe2(this['_documentId'],_0x28138d,_0x3e82b9);await this['_sendRequest'](_0x44abe2['TYPE'],_0x183629);}async['removeCommentThread'](_0x27d2d8){const _0x4ce610=new _0x44cb61(this['_documentId'],_0x27d2d8);await this['_sendRequest'](_0x44cb61['TYPE'],_0x4ce610);}async['addCommentThread'](_0x3e7222){var _0x589ee7;const _0x49d53d=new _0x3606cf(this['_documentId'],_0x3e7222['commentThreadId'],null===(_0x589ee7=_0x3e7222['comments'])||void 0x0===_0x589ee7?void 0x0:_0x589ee7['map'](_0x110c98=>({..._0x110c98,'documentId':this['_documentId'],'commentThreadId':_0x3e7222['commentThreadId']})),_0x3e7222['context'],_0x3e7222['resolvedBy'],_0x3e7222['createdAt'],_0x3e7222['resolvedAt'],_0x3e7222['deletedAt'],_0x3e7222['attributes']),_0xe2a3b1=await this['_sendRequest'](_0x3606cf['TYPE'],_0x49d53d);return _0x4e19b2['decode'](_0xe2a3b1,_0x2e10b1);}async['resolveCommentThread'](_0x1a471c){const _0x463eea=new _0x23fd91(_0x1a471c,this['_documentId']),_0x2f466a=await this['_sendRequest'](_0x23fd91['TYPE'],_0x463eea);return _0x4e19b2['decode'](_0x2f466a,_0x249faa);}async['reopenCommentThread'](_0x4b213b){const _0x56f281=new _0x1d096b(_0x4b213b,this['_documentId']);await this['_sendRequest'](_0x1d096b['TYPE'],_0x56f281);}async['updateCommentThread'](_0x409355){const _0x5620c3=new _0x441895(_0x409355['commentThreadId'],this['_documentId'],_0x409355['context'],_0x409355['attributes'],_0x409355['unlinkedAt']);await this['_sendRequest'](_0x441895['TYPE'],_0x5620c3);}async['getCommentThread'](_0x255109,_0x2a45e0=0x1){const _0x187a10=new _0x183f9f(_0x255109,this['_documentId']);try{const _0x4192ce=await this['_sendRequest'](_0x183f9f['TYPE'],_0x187a10),_0x562080=_0x4e19b2['decode'](_0x4192ce,_0x4a3b9d);return{'commentThreadId':_0x562080['commentThreadId'],'comments':_0x562080['comments'],'attributes':_0x562080['attributes'],'context':_0x562080['context'],'resolvedAt':_0x562080['resolvedAt'],'resolvedBy':_0x562080['resolvedBy'],'deletedAt':_0x562080['deletedAt'],'unlinkedAt':_0x562080['unlinkedAt']};}catch(_0x184ffb){if('CKEditorCloudServicesServerError'===_0x184ffb['name']&&'404'===_0x184ffb['code']&&_0x2a45e0<0x5)return await(_0x402640=0x64*_0x2a45e0,new Promise(_0x52b4f1=>{setTimeout(_0x52b4f1,_0x402640);})),this['getCommentThread'](_0x255109,_0x2a45e0+0x1);if('CKEditorCloudServicesServerError'===_0x184ffb['name'])throw _0x184ffb;throw _0x2f3a17['fromPublicError'](_0x184ffb);}var _0x402640;}async['getDocumentThreads'](){const _0x30a37b=new _0xfe35a7(this['_documentId']),_0x37e385=await this['_sendRequest'](_0xfe35a7['TYPE'],_0x30a37b),{threads:_0xc1f604}=_0x4e19b2['decode'](_0x37e385,_0x35b79f);return{'threads':_0xc1f604};}async['getConnectedSessions'](){if(!this['_isConnected'])throw new _0x169f97('Comments',this);return this['_connectedSessions']||(this['_connectedSessions']=await _0x210767['getConnectedSessions'](this['_wsGateway'],this['_documentId'],0x9)),this['_connectedSessions'];}['_connectToChannel'](_0x574932,_0x56ce0c){this['_channel']=_0x574932['_getChannel'](CommentsService['_SERVICE'],_0x56ce0c),this['_channel']&&(this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x4cde4a['TYPE']),(_0x1c7657,_0x26be34)=>{const _0x1fcc39=_0x4e19b2['decode'](_0x26be34,_0x4cde4a);this['fire']('commentAdded',_0x1fcc39);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x44abe2['TYPE']),(_0x5126d8,_0x5ad6c8)=>{const _0x24c38a=_0x4e19b2['decode'](_0x5ad6c8,_0x44abe2);this['fire']('commentRemoved',_0x24c38a);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x31fa89['TYPE']),(_0x51042f,_0x586884)=>{const _0x5319e7=_0x4e19b2['decode'](_0x586884,_0x31fa89);this['fire']('commentUpdated',_0x5319e7);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x44cb61['TYPE']),(_0x4acb90,_0x4c75bf)=>{const _0x5965da=_0x4e19b2['decode'](_0x4c75bf,_0x44cb61);this['fire']('commentThreadRemoved',_0x5965da);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x3606cf['TYPE']),(_0x4adcf8,_0x2bbe26)=>{const _0xb654b5=_0x4e19b2['decode'](_0x2bbe26,_0x3606cf);this['fire']('commentThreadAdded',_0xb654b5);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x441895['TYPE']),(_0x22987f,_0x427324)=>{const _0x2f5ff9=_0x4e19b2['decode'](_0x427324,_0x441895);this['fire']('commentThreadUpdated',_0x2f5ff9);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x23fd91['TYPE']),(_0x317393,_0x48008a)=>{const _0x4b0ab5=_0x4e19b2['decode'](_0x48008a,_0x23fd91);this['fire']('commentThreadResolved',_0x4b0ab5);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x1d096b['TYPE']),(_0x520743,_0x510fd9)=>{const _0x47cd23=_0x4e19b2['decode'](_0x510fd9,_0x1d096b);this['fire']('commentThreadReopened',_0x47cd23);}));}['_onWsGatewayStateChange'](_0x259d6b){_0x259d6b===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0xef818f,_0x467705){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x169f97('Comments',this);return this['_wsGateway']['_sendRequest'](0x9,_0xef818f,_0x4e19b2['encode'](_0x467705));}}CommentsService['_SERVICE']=0x9;export default CommentsService;