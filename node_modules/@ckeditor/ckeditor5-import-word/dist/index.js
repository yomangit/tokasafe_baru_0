/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x46ad71,Command as _0x310cb5}from'@ckeditor/ckeditor5-core/dist/index.js';import{FileDialogButtonView as _0x43de9f,MenuBarMenuListItemFileDialogButtonView as _0xfdaae5,SpinnerView as _0x25eb7d,Notification as _0x44877e}from'@ckeditor/ckeditor5-ui/dist/index.js';import{ClipboardPipeline as _0x5196d4}from'@ckeditor/ckeditor5-clipboard/dist/index.js';import{Range as _0x45ccc4}from'@ckeditor/ckeditor5-engine/dist/index.js';import{first as _0x54fbbf,uid as _0x420808,logWarning as _0x41d5e2,logError as _0x2cd2f5}from'@ckeditor/ckeditor5-utils/dist/index.js';function p(_0x5ab0eb,_0x2c6748){const t=_0x5ab0eb['t'];switch(_0x2c6748){case'Import\x20from\x20Word':return t('Import\x20from\x20Word');case'An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.':return t('An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.');case'Importing\x20Word\x20document':return t('Importing\x20Word\x20document');default:return _0x2c6748;}}class i extends _0x46ad71{static get['pluginName'](){return'ImportWordUI';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}['init'](){const _0x567a3f=this['editor'];_0x567a3f['ui']['componentFactory']['add']('importWord',()=>{const _0x372633=this['_createButton'](_0x43de9f),_0x539770=_0x567a3f['commands']['get']('importWord');return _0x372633['bind']('isOn')['to'](_0x539770,'isBusy'),_0x372633['tooltip']=!0x0,_0x372633;}),_0x567a3f['ui']['componentFactory']['add']('menuBar:importWord',()=>this['_createButton'](_0xfdaae5));}['_createButton'](_0xc97bf4){const _0xee316d=this['editor'],_0x89801b=_0xee316d['commands']['get']('importWord'),_0x2cf2ca=new _0xc97bf4(_0xee316d['locale']),_0xdb6c30=new _0x25eb7d();return _0x2cf2ca['set']({'acceptedType':'application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.wordprocessingml.template'}),_0x2cf2ca['set']({'icon':'<svg\x20viewBox=\x220\x200\x2020\x2020\x22\x20xmlns=\x22http://www.w3.org/2000/svg\x22><path\x20d=\x22m14\x200\x205\x204.5v8.892l-1.5-1.8V6.5h-5v-5h-8v3H3V0h11Zm0\x202v3h3.3L14\x202Z\x22/><path\x20d=\x22M10.74\x2018a2.76\x202.76\x200\x200\x201-.469-.5H3V19h9.25v-.374A2.737\x202.737\x200\x200\x201\x2010.74\x2018Z\x22/><path\x20d=\x22M8.5\x206a1.5\x201.5\x200\x200\x201\x201.493\x201.356L10\x207.5v7a1.5\x201.5\x200\x200\x201-1.356\x201.493L8.5\x2016h-7a1.5\x201.5\x200\x200\x201-1.493-1.356L0\x2014.5v-7a1.5\x201.5\x200\x200\x201\x201.356-1.493L1.5\x206h7ZM7.483\x208.795l-.042.088-.986\x202.534-.947-2.528-.043-.092a.601.601\x200\x200\x200-1.042.008l-.042.093-.883\x202.465-.937-2.475-.042-.089a.6.6\x200\x200\x200-1.107.42l.027.093\x201.514\x204\x20.044.092a.6.6\x200\x200\x200\x201.041-.01l.041-.092.88-2.458.925\x202.467.046.096a.602.602\x200\x200\x200\x201.032\x200l.043-.09\x201.554-4\x20.028-.093a.6.6\x200\x200\x200-1.104-.43v.001ZM11.674\x2015.407a.75.75\x200\x201\x200\x201.152.96L14\x2014.96V20h1.5v-5.04l1.174\x201.408a.75.75\x200\x201\x200\x201.152-.96l-2.346-2.816a.95.95\x200\x200\x200-1.46\x200l-2.346\x202.815Z\x22/></svg>\x0a'}),_0x2cf2ca['bind']('isEnabled')['to'](_0x89801b),_0x2cf2ca['bind']('label')['to'](_0x89801b,'isBusy',_0x365eaf=>p(_0xee316d['locale'],_0x365eaf?'Importing\x20Word\x20document':'Import\x20from\x20Word')),_0xdb6c30['bind']('isVisible')['to'](_0x89801b,'isBusy'),_0x2cf2ca['iconView']['bind']('isVisible')['to'](_0x89801b,'isBusy',_0x29621f=>!_0x29621f),_0x2cf2ca['children']['add'](_0xdb6c30),_0x2cf2ca['on']('done',(_0x207e0f,_0x1da099)=>{_0xee316d['execute']('importWord',_0x1da099[0x0],{}),_0xee316d['editing']['view']['focus']();}),_0x2cf2ca;}}class d extends _0x310cb5{['_importMarker'];['_undoStepBatch'];['_abortController'];constructor(_0xbb12db){super(_0xbb12db),this['set']('isBusy',!0x1),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['on']('dataInsert',(_0x35b20a,_0x2fe3eb)=>{const _0x18221e=new DataTransfer();_0x18221e['setData']('text/html',_0x2fe3eb['html']);const _0x8b5646=this['_importMarker']['getRange']();this['editor']['model']['enqueueChange'](this['_undoStepBatch'],_0x133a5c=>{this['_importMarker']['stopListening'](),_0x133a5c['setSelection'](_0x8b5646),_0xbb12db['editing']['view']['document']['fire']('clipboardInput',{'dataTransfer':_0x18221e});});},{'priority':'low'});}['refresh'](){this['isEnabled']=this['_checkEnabled']();}['execute'](_0x7edad5,_0xbce185={}){if(this['isBusy'])return Promise['resolve']();const _0x44f699=this['editor']['config']['get']('importWord');if(this['editor']['plugins']['has']('MergeFields')){const {prefix:_0x5ac06c,suffix:_0x3bcef9}=this['editor']['config']['get']('mergeFields');_0xbce185['merge_fields']={'prefix':_0x5ac06c,'suffix':_0x3bcef9};}const _0x572096={'url':_0x44f699['converterUrl'],'file':_0x7edad5,'serviceConfig':{..._0xbce185,'formatting':_0x44f699['formatting'],'timezone':new Intl['DateTimeFormat']()['resolvedOptions']()['timeZone']}};return this['_prepareForImport'](),this['_sendImportRequest'](_0x572096)['then'](this['_handleImportResponse']['bind'](this))['catch'](this['_handleImportFailure']['bind'](this))['finally'](this['_cleanUpAfterImport']['bind'](this));}['_checkEnabled'](){if(this['isBusy'])return!0x1;const _0xa418b5=this['editor']['model'],_0x5e9fe7=_0xa418b5['schema'],_0x455720=_0xa418b5['document']['selection'],_0x3678af=_0x54fbbf(_0x455720['getSelectedBlocks']());return!!_0x3678af&&_0x5e9fe7['checkChild'](_0x3678af['parent'],'paragraph');}['_prepareForImport'](){const _0xd7d412=this['editor'],_0x319a21=_0xd7d412['model'],_0x5d0f8c=_0x319a21['document']['selection'];this['_abortController']=new AbortController(),this['_undoStepBatch']=_0xd7d412['model']['createBatch']({'isUndoable':!0x0}),_0x319a21['enqueueChange'](this['_undoStepBatch'],_0x8ac2c6=>{_0x5d0f8c['isCollapsed']||_0x319a21['deleteContent'](_0x5d0f8c,{'leaveUnmerged':!0x0});const _0x4933ce=_0x5d0f8c['getFirstPosition'](),_0x271947=_0x54fbbf(_0x5d0f8c['getSelectedBlocks']());let _0x251279;_0x251279=_0x271947['is']('element','paragraph')&&_0x271947['isEmpty']?_0x4933ce:_0x4933ce['isAtStart']?_0x319a21['createPositionBefore'](_0x271947):_0x4933ce['isAtEnd']?_0x319a21['createPositionAfter'](_0x271947):_0x8ac2c6['split'](_0x4933ce)['position'],this['_importMarker']=_0x8ac2c6['addMarker']('importWord:'+_0x420808(),{'usingOperation':!0x1,'affectsData':!0x1,'range':new _0x45ccc4(_0x251279)}),this['_importMarker']['on']('change:range',()=>{'$graveyard'===this['_importMarker']['getRange']()['root']['rootName']&&this['_abortController']['abort']();});}),this['isBusy']=!0x0,this['refresh']();}['_cleanUpAfterImport'](){const _0x2cfce0=this['editor']['model'];_0x2cfce0['markers']['has'](this['_importMarker'])&&_0x2cfce0['enqueueChange'](this['_undoStepBatch'],_0x5ddeda=>{_0x5ddeda['removeMarker'](this['_importMarker']);}),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['isBusy']=!0x1,this['refresh']();}['_sendImportRequest']({url:_0x59d166,file:_0x5d301d,serviceConfig:_0x1d4ff1}){const _0x4deca0=this['editor']['plugins']['get']('ImportWordEditing')['getToken'](),_0x44f155=new FormData();_0x44f155['set']('config',JSON['stringify'](_0x1d4ff1)),_0x44f155['set']('file',_0x5d301d);const _0x56a795={'method':'POST','headers':{},'body':_0x44f155,'signal':this['_abortController']['signal']};return _0x4deca0&&(_0x56a795['headers']['Authorization']=_0x4deca0['value']),fetch(_0x59d166,_0x56a795);}['_handleImportResponse'](_0x2e5713){return _0x2e5713['ok']?_0x2e5713['json']()['then'](_0x579b97=>{if(!this['editor']['model']['markers']['has'](this['_importMarker']))return;'$graveyard'!==this['_importMarker']['getRange']()['root']['rootName']&&this['fire']('dataInsert',_0x579b97);}):Promise['reject']();}['_handleImportFailure'](){if(this['_abortController']['signal']['aborted'])return void _0x41d5e2('import-word-plugin-import-cancelled');const _0x373408=this['editor'],_0x4fd371=p(_0x373408['locale'],'An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.');_0x373408['plugins']['get']('Notification')['showWarning'](_0x4fd371),_0x2cd2f5('import-word-plugin-conversion-failed');}}class e extends _0x46ad71{['_token'];static get['pluginName'](){return'ImportWordEditing';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}static get['requires'](){return[_0x44877e,_0x5196d4,'CloudServices'];}constructor(_0x331e3e){super(_0x331e3e),this['_token']=null;}async['init'](){const _0x2d6696=this['editor'];_0x2d6696['config']['define']('importWord',{'converterUrl':'https://docx-converter.cke-cs.com/v2/convert/docx-html','tokenUrl':(_0x2d6696['config']['get']('cloudServices')||{})['tokenUrl'],'formatting':{'resets':'none','defaults':'none','styles':'inline'}}),_0x2d6696['commands']['add']('importWord',new d(_0x2d6696));const {tokenUrl:_0x48eec6}=_0x2d6696['config']['get']('importWord');if(_0x48eec6){const {tokenUrl:_0x233545}=_0x2d6696['config']['get']('cloudServices')||{};this['_token']=_0x48eec6===_0x233545?_0x2d6696['plugins']['get']('CloudServices')['token']:await _0x2d6696['plugins']['get']('CloudServices')['registerTokenUrl'](_0x48eec6);}}['getToken'](){return this['_token'];}}class o extends _0x46ad71{static get['pluginName'](){return'ImportWord';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}static get['requires'](){return[e,i];}}export{o as ImportWord,e as ImportWordEditing,i as ImportWordUI};